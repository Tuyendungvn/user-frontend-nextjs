{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { useEffect, useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { isEmpty } from \"lodash\";\nimport Dialog from \"@components/Dialog\";\nimport { renderCareer } from \"@common/functions\";\nimport { Button, ButtonWrapper, ButtonDialog, ButtonDialogWrapper, Career, CompanyCardContainer, CompanyCardWrapper, Content, DialogContainer, DialogContent, DialogTitle, Img, Link, Location, Logo, Title } from \"./styles\";\nimport { PATH } from \"@routes\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { createRequestReview, getAllRequestReview } from \"@redux/actions/requestReview\";\nimport { refreshToken } from \"@redux/actions/auth\";\nimport { resetAction } from \"@redux/actions/common\";\nimport { useRedirect } from \"@common/hooks/useRedirect\";\nimport { createNotify } from \"@redux/actions/notification\";\nconst skeletonImage = \"/img/skeleton/default-small.jpg\";\n\nconst CompanyCard = ({\n  company,\n  request = true,\n  companyLocation = \"\"\n}) => {\n  const {\n    t\n  } = useTranslation([\"company\"]);\n  const dispatch = useDispatch();\n  const redirect = useRedirect();\n  const {\n    0: open,\n    1: setOpen\n  } = useState(false);\n  const {\n    0: isRequest,\n    1: setIsRequest\n  } = useState(false);\n  const {\n    currentUser\n  } = useSelector(state => state.auth);\n  const {\n    actionSuccess\n  } = useSelector(state => state.actions);\n  const {\n    requestReviewList: {\n      results: requestReviewList = []\n    }\n  } = useSelector(state => state.requestReview);\n  const userInfo = (currentUser === null || currentUser === void 0 ? void 0 : currentUser.userInfo) || {};\n  const {\n    logo,\n    name,\n    career,\n    province\n  } = company;\n  const careerArray = career === null || career === void 0 ? void 0 : career.map(item => item === null || item === void 0 ? void 0 : item.name);\n  const careerString = renderCareer(careerArray);\n  const locationArray = province === null || province === void 0 ? void 0 : province.map(item => item === null || item === void 0 ? void 0 : item.name);\n  const locationString = renderCareer(locationArray);\n  useEffect(() => {\n    if (!isEmpty(currentUser)) {\n      getRequestedAPI();\n    }\n  }, [currentUser]);\n  useEffect(() => {\n    if ((requestReviewList === null || requestReviewList === void 0 ? void 0 : requestReviewList.length) > 0) {\n      checkRequested();\n    }\n  }, [requestReviewList]);\n  useEffect(() => {\n    if (actionSuccess) {\n      dispatch(resetAction());\n      dispatch(refreshToken());\n      checkRequested();\n    }\n  }, [actionSuccess]);\n\n  const handleRequest = () => {\n    var _company$user2;\n\n    if (isEmpty(currentUser)) {\n      redirect(PATH.LOGIN);\n    } else {\n      if (company !== null && company !== void 0 && company._id) {\n        var _company$user;\n\n        dispatch(createRequestReview({\n          createRequestReviewInput: {\n            candidate: userInfo === null || userInfo === void 0 ? void 0 : userInfo._id,\n            employer: company === null || company === void 0 ? void 0 : (_company$user = company.user) === null || _company$user === void 0 ? void 0 : _company$user._id,\n            status: \"waiting_for_review\"\n          }\n        }));\n      }\n    }\n\n    setOpen(false);\n    const payload = {\n      notifyCreateInput: {\n        user: company === null || company === void 0 ? void 0 : (_company$user2 = company.user) === null || _company$user2 === void 0 ? void 0 : _company$user2._id,\n        name: \"Required\",\n        company: company === null || company === void 0 ? void 0 : company._id,\n        description: `${userInfo === null || userInfo === void 0 ? void 0 : userInfo.displayName} đã yêu cầu bạn đánh giá hồ sơ của họ.`\n      }\n    };\n    dispatch(createNotify(payload));\n  };\n\n  const getRequestedAPI = () => {\n    var _company$user3;\n\n    const payload = {\n      filterRequestReview: {\n        candidate: userInfo === null || userInfo === void 0 ? void 0 : userInfo._id,\n        employer: company === null || company === void 0 ? void 0 : (_company$user3 = company.user) === null || _company$user3 === void 0 ? void 0 : _company$user3._id\n      }\n    };\n    dispatch(getAllRequestReview(payload));\n  };\n\n  const checkRequested = () => {\n    const listRequestId = requestReviewList === null || requestReviewList === void 0 ? void 0 : requestReviewList.map(item => {\n      var _item$candidate;\n\n      return item === null || item === void 0 ? void 0 : (_item$candidate = item.candidate) === null || _item$candidate === void 0 ? void 0 : _item$candidate._id;\n    });\n    const listCompanyRequestId = requestReviewList === null || requestReviewList === void 0 ? void 0 : requestReviewList.map(item => {\n      var _item$employer, _item$employer$compan;\n\n      return item === null || item === void 0 ? void 0 : (_item$employer = item.employer) === null || _item$employer === void 0 ? void 0 : (_item$employer$compan = _item$employer.company) === null || _item$employer$compan === void 0 ? void 0 : _item$employer$compan._id;\n    });\n\n    if (listRequestId.includes(userInfo === null || userInfo === void 0 ? void 0 : userInfo._id) && listCompanyRequestId.includes(company === null || company === void 0 ? void 0 : company._id)) {\n      setIsRequest(true);\n    }\n  };\n\n  return /*#__PURE__*/_jsx(CompanyCardWrapper, {\n    className: \"container\",\n    children: /*#__PURE__*/_jsxs(CompanyCardContainer, {\n      children: [/*#__PURE__*/_jsx(Logo, {\n        children: /*#__PURE__*/_jsx(Img, {\n          src: (logo === null || logo === void 0 ? void 0 : logo.small) || (logo === null || logo === void 0 ? void 0 : logo.default) || (logo === null || logo === void 0 ? void 0 : logo.medium) || skeletonImage,\n          alt: name,\n          loading: \"lazy\"\n        })\n      }), /*#__PURE__*/_jsxs(Content, {\n        children: [/*#__PURE__*/_jsx(Title, {\n          children: name\n        }), companyLocation && /*#__PURE__*/_jsx(Location, {\n          children: companyLocation\n        }), !companyLocation && (province === null || province === void 0 ? void 0 : province.length) > 0 && /*#__PURE__*/_jsx(Location, {\n          children: locationString\n        }), (career === null || career === void 0 ? void 0 : career.length) > 0 && /*#__PURE__*/_jsx(Career, {\n          children: careerString\n        })]\n      }), request && /*#__PURE__*/_jsxs(ButtonWrapper, {\n        children: [/*#__PURE__*/_jsx(Button, {\n          onClick: () => setOpen(true),\n          style: {\n            opacity: isRequest ? 0.5 : 1,\n            pointerEvents: isRequest ? \"none\" : \"initial\"\n          },\n          children: isEmpty(currentUser) ? t(\"required-rating-title\") : isRequest ? t(\"requested\") : t(\"required-rating-title\")\n        }), /*#__PURE__*/_jsx(Dialog, {\n          isOpen: open,\n          onClose: () => setOpen(false),\n          className: \"z-50 rounded-none w-max\",\n          children: /*#__PURE__*/_jsxs(DialogContainer, {\n            children: [/*#__PURE__*/_jsx(DialogTitle, {\n              children: t(\"required-rating-title\")\n            }), /*#__PURE__*/_jsx(DialogContent, {\n              children: !isEmpty(currentUser) ? t(\"required-rating-content\").replace(\"$companyName\", String(name)) : t(\"no-login\")\n            }), /*#__PURE__*/_jsxs(ButtonDialogWrapper, {\n              children: [/*#__PURE__*/_jsx(ButtonDialog, {\n                onClick: () => setOpen(false),\n                children: t(\"cancel\")\n              }), Object.keys(userInfo).length > 0 ? /*#__PURE__*/_jsx(ButtonDialog, {\n                isAccept: true,\n                onClick: handleRequest,\n                children: t(\"accept\")\n              }) : /*#__PURE__*/_jsx(Link, {\n                routeName: PATH.LOGIN,\n                children: t(\"accept\")\n              })]\n            })]\n          })\n        })]\n      })]\n    })\n  });\n};\n\nexport default CompanyCard;","map":null,"metadata":{},"sourceType":"module"}